# OneSignalQml
OneSignal is a free push notification service for mobile apps. This package allows you to integrate OneSignal's native SDK functionality into your Qt/QML based iOS and Android applications.

## Installation

### Step One: Cloning
Installing OneSignalQml is easy, just add this Git repository as a submodule (or copy the contents of the repository) to your project.

If using the `git` command, you can add the submodule in one line:

```
git submodule add https://github.com/lukevear/OneSignalQml.git lib/OneSignalQml
```

### Step Two: Installing OneSignal
Natrually you're going to need to add the relevant OneSignal libraries to your project for this package to function.

On iOS, you can simple copy `OneSignal.framework` from the '*iOS_SDK/Framework*' folder in the official [OneSignal iOS Repository](https://github.com/OneSignal/OneSignal-iOS-SDK) to a destination within your project (personally I use `<project path>/lib/Frameworks`).

On Android, you need to follow the instructions in section "1. Gradle Setup" on the official [Android SDK Documentation](https://documentation.onesignal.com/docs/android-sdk-setup). You only need to configure gradle - do not perform any other steps.

### Step Three: Qt Project Configuration
One you have completed the above steps, all that's left to make sure qmake and the compiler can find everything it needs. To achieve this, you'll need to include this package in your `.pro` file, like this (remember to change the path as appropiate):

```
include(lib/OneSignalQml/OneSignalQml.pri)
```

#### iOS Specific Steps
If developing for iOS, you'll need to let clang know where `OneSignal.framework` is located:

```
ios {
    # Include our Frameworks
    QMAKE_CXXFLAGS += -std=c++11 -stdlib=libc++ -F$$PWD/lib/Frameworks
    QMAKE_LFLAGS += -stdlib=libc++ -F$$PWD/lib/Frameworks
    
    # Include the OneSignal SDK
    LIBS += -lz -framework OneSignal
}
```

Once clang is able to find the framework, your then need to configure your `Info.plist` with the `remote-notification` background mode (a sample `Info.plist` is available in *tests/bundles/ios*). You then need to add the custom `Info.plist` to your `.pro` file so that when qmake generates an Xcode project it is automatically included:

```
ios {
    # Add our custom Info.plist
    QMAKE_INFO_PLIST = $$PWD/bundles/ios/Info.plist
}
```

Finally, you need to toggle the "Push Notifications" capability in Xcode (open the `.xcodeproj` generated by qmake).

#### Android Specific Steps
There are none!

### Step Four: QML Context
Now that you have added OneSignal to your project, the last step to complete installation is to register the QML context for OneSignalQml. To do this, add the following to `main.cpp` (ensure you place it before you load your main `.qml` file):

```
#include "onesignalqml.h"

int main(int argc, char *argv[])
{
    // Register OneSignalQml
    OneSignalQml::registerQmlContext(); 
    
    // Perform other work, such as loading your main QML file
}
```

## OneSignal Initialisation
As per the official OneSignal documentation, once you've install OneSignal you need to call the `init` function on the SDK to bootstrap the service.

We expose this `init` method through convient wrapper that handles all the configuration from a single line. By default, we disable the automatic prompt to grant push notifications, so don't forget to call `OneSignal.registerForPushNotifications()` in your QML when appropiate.

#### iOS
In the `didFinishLaunchingWithOptions` method in a custom `appdelegate.mm`, insert the following:

```
#include "onesignalqml.h"

- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions {

    // Initiate OneSignal
    OneSignalQml::init("<your-onesignal-project-id>", launchOptions, OneSignalQml::InFocusNotificationDisplay::None);

    return YES;
}
```

To help you determine which `InFocusNotificationDisplay` option is right for you, see the [official documentation](https://documentation.onesignal.com/docs/ios-native-sdk#section--kossettingskeyinfocusdisplayoption-).

Note: If you don't have a custom application delegate, look in *tests/bundles/ios* (and corresponding line in the `.pro` file) for an example.

#### Android
In the `main` method of your `main.cpp`, insert the following line under `OneSignalQml::registerQmlContext();`:

```
#if defined(Q_OS_ANDROID)
    OneSignalQml::init(OneSignalQml::InFocusNotificationDisplay::None);
#endif
```

To help you determine which `InFocusNotificationDisplay` option is right for you, see the [official documentation](https://documentation.onesignal.com/docs/android-native-sdk#section--infocusdisplaying-).

## Using OneSignalQml
Now that everything is set up - you can use OneSignal!

### Qml Import Statement
To use OneSignalQml in your own QML files, simply use the following import statement:

```
import OneSignal 1.0
```

### Method Reference
The below table provides a reference for each method available in OneSignalQml, and the corresponding OneSignal iOS/Android SDK method that is called.

| OneSignalQml Method | Corresponding iOS SDK Method |  CorrespondingAndroid SDK Method |
|---------------------|------------------------------|----------------------------------|
|                     |                              |                                  |
|                     |                              |                                  |
|                     |                              |                                  |
